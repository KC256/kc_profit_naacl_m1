nohup: 入力を無視します
/home/fukuda/miniconda3/envs/Profit-naacl/lib/python3.9/site-packages/pyfolio/pos.py:26: UserWarning: Module "zipline.assets" not found; mutltipliers will not be applied to position notionals.
  warnings.warn(
start time: 2024-11-06 20:04:20.530415
INPUT_TEXT: tweetonly
USING_MODEL: model_2
output:  output/Humanoid-v2-run1
train_pickle:  ../../datasets/pickles_0tumeru/S_test_data_sorted_in_jsons_6_2015-10-01~2015-10-03_20_7_5_384.pkl
test_pickle:  ../../datasets/pickles_0tumeru/S_test_data_sorted_in_jsons_6_2015-10-01~2015-10-03_20_7_5_384.pkl
args.validate_steps: 25
args.epsilon: 50000
HMAX_NORMALIZE: 10
SELECT_ACTION: default
TRANSACTION_FEE_PERCENT 0.000495
args.train_iter: 3
args.seed: 1
args.bsize: 1
{'mode': 'train', 'env': 'Humanoid-v2', 'hidden1': 400, 'hidden2': 300, 'rate': 0.001, 'prate': 0.0001, 'warmup': 1, 'discount': 0.99, 'bsize': 1, 'rmsize': 25, 'window_length': 1, 'tau': 0.001, 'ou_theta': 0.15, 'ou_sigma': 0.2, 'ou_mu': 0.0, 'validate_episodes': 1, 'max_episode_length': 500, 'validate_steps': 25, 'output': 'output', 'debug': False, 'init_w': 0.003, 'train_iter': 3, 'epsilon': 50000, 'seed': 1, 'resume': 'default', 'model': 'time', 'diff': None, 'test_pickle': '../../datasets/pickles_0tumeru/S_test_data_sorted_in_jsons_6_2015-10-01~2015-10-03_20_7_5_384.pkl', 'train_pickle': '../../datasets/pickles_0tumeru/S_test_data_sorted_in_jsons_6_2015-10-01~2015-10-03_20_7_5_384.pkl', 'initial_account_balance': '100000', 'resumes_folder_path': None, 'wantoutput': 'yes'}
MEMO:
          
  0%|          | 0/3 [00:00<?, ?it/s] 33%|███▎      | 1/3 [00:00<00:00,  3.59it/s] 67%|██████▋   | 2/3 [00:00<00:00,  4.51it/s]args.warmup  1

step: 0
day: 0 train
actions: [-1.7504168  -3.79327639 -6.76805472 -7.10376485  6.68111589  0.01543635
 -3.59426029 -8.19937728  0.65041699 -0.59833555 -4.78561665 -1.53267934
 -1.32579985  8.49014183  8.97270129  1.83823471  5.15006112  5.36317537
  2.56481163 -8.16666345]
argsort_actions: [ 7 19  3  2 10  1  6  0 11 12  9  5  8 15 18 16 17  4 13 14]
sell index:[ 7 19  3  2 10  1  6  0 11 12  9]  buy index:[14 13  4 17 16 18 15  8  5] 
self.sell_num, self.buy_num, self.hold_num: 0 9 11
self.state[HOLDING_IDX~EMB_IDX]: [0, 0, 0, 0, 6.681115886086014, 0.015436352984978807, 0, 0, 0.6504169935028115, 0, 0, 0, 0, 8.490141825470587, 8.972701292259998, 1.8382347079257144, 5.150061117726694, 5.363175367831929, 2.5648116328333592, 0]
diff_previousday_state[HOLDING_IDX~EMB_IDX]: [0.         0.         0.         0.         6.68111589 0.01543635
 0.         0.         0.65041699 0.         0.         0.
 0.         8.49014183 8.97270129 1.83823471 5.15006112 5.36317537
 2.56481163 0.        ]
self.state[TARGET_IDX:PRICEDIFF~IDX]: [52.269245, 133.142044, 520.719971, 122.81459, 181.770004, 24.214939, 63.970062, 132.808884, 23.851751, 28.211098, 37.610397, 89.324226, 93.24482, 88.680862, 29.549698, 30.251495, 113.232193, 92.87384, 68.830414, 68.946892]
daybefore_stockprices: [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
stockprices_raio: [1, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
hold_price_ratio [0.9643817185742092, 0.0, 0.0, 0.0, 0.0, 0.01214447872951136, 3.7379693622974844e-06, 0.0, 0.0, 0.00015513857695965174, 0.0, 0.0, 0.0, 0.0, 0.007529263702328963, 0.00265145288137721, 0.0005561032852679897, 0.005831629960384858, 0.004981074730065439, 0.0017654015905330758, 0.0]
y_w: [0.9643817185742092, 0.0, 0.0, 0.0, 0.0, 0.01214447872951136, 3.7379693622974844e-06, 0.0, 0.0, 0.00015513857695965174, 0.0, 0.0, 0.0, 0.0, 0.007529263702328963, 0.00265145288137721, 0.0005561032852679897, 0.005831629960384858, 0.004981074730065439, 0.0017654015905330758, 0.0]
sum(y_w): 1.0000000000000002
end_total_asset [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 1.21442646e+03 3.73790346e-01 0.00000000e+00 0.00000000e+00
 1.55135842e+01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 7.52913096e+02 2.65140613e+02 5.56093481e+01
 5.83152714e+02 4.98098691e+02 1.76537047e+02 0.00000000e+00]
begin_total_asset [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
self.daybefore_end_total_asset [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
self.args.diff: None
self.reward: -0.00017630738457082772
sum end_total_asset(stocks): 3561.7653449186732
self.state[0](cash): 96436.47158123562
today cost: 1.7630738457347435
step_end: 1

step: 1
day: 1 train
actions: [-1.16859903 -1.56440362  2.0119024   1.31203747 -0.08330095 -0.89705485
 -9.14831225  2.36514138  0.29243245  2.53951032 -8.7171654  -2.47816233
 -9.49703951  2.4859038  -7.6357525   3.40789717 -5.89566483 -2.92677894
 -1.77137697 -4.00938311]
argsort_actions: [12  6 10 14 16 19 17 11 18  1  0  5  4  8  3  2  7 13  9 15]
sell index:[12  6 10 14 16 19 17 11 18  1  0  5  4]  buy index:[15  9 13  7  2  3  8] 
self.sell_num, self.buy_num, self.hold_num: 6 7 7
self.state[HOLDING_IDX~EMB_IDX]: [0, 0, 2.011902395068166, 1.3120374694223313, 6.597814936538129, 0.0, 0, 2.3651413846373703, 0.9428494480707639, 2.5395103157640264, 0, 0, 0, 10.976045623493476, 1.3369487915969005, 5.246131876360105, 0.0, 2.43639643066327, 0.7934346636952605, 0]
diff_previousday_state[HOLDING_IDX~EMB_IDX]: [ 0.          0.          2.0119024   1.31203747 -0.08330095 -0.01543635
  0.          2.36514138  0.29243245  2.53951032  0.          0.
  0.          2.4859038  -7.6357525   3.40789717 -5.15006112 -2.92677894
 -1.77137697  0.        ]
self.state[TARGET_IDX:PRICEDIFF~IDX]: [52.436836, 135.268829, 532.539978, 124.648239, 183.139999, 24.243172, 64.967117, 133.722, 24.116873, 28.690685, 38.167938, 90.643471, 94.198227, 88.973793, 30.700506, 30.659801, 115.387878, 93.627548, 69.499153, 70.641235]
daybefore_stockprices: [52.269245, 133.142044, 520.719971, 122.81459, 181.770004, 24.214939, 63.970062, 132.808884, 23.851751, 28.211098, 37.610397, 89.324226, 93.24482, 88.680862, 29.549698, 30.251495, 113.232193, 92.87384, 68.830414, 68.946892]
stockprices_raio: [1, 1.0032063022911466, 1.0159738046383004, 1.0226993540833487, 1.0149302212383724, 1.007536969631139, 1.0011659331456504, 1.0155862753423626, 1.006875413545377, 1.0111154103528919, 1.0169999409452266, 1.0148241189796534, 1.0147691735946305, 1.0102247717353092, 1.0033032042471577, 1.0389448311789853, 1.0134970519638782, 1.019037739558749, 1.0081153961115423, 1.009715748622404, 1.0245746102666962]
hold_price_ratio [0.956846875036189, 0.0, 0.0, 0.010710285752476085, 0.0016348364781109167, 0.01207884119979911, 0.0, 0.0, 0.0031615634719104843, 0.00022730305980989715, 0.0007283377715485821, 0.0, 0.0, 0.0, 0.009762250402292711, 0.00041030068397467675, 0.001607868288060491, 0.0, 0.002280308146749273, 0.0005512297090787499, 0.0]
y_w: [0.956846875036189, 0.0, 0.0, 0.010953402321105385, 0.0016592449484176743, 0.012169879059101345, 0.0, 0.0, 0.0031833005282298267, 0.00022982962659415208, 0.000740719470653086, 0.0, 0.0, 0.0, 0.009794497109283382, 0.00042627977484469275, 0.0016295697698955152, 0.0, 0.00229881375061652, 0.00055658531836536, 0.0]
sum(y_w): 1.000488996713296
end_total_asset [   0.            0.         1071.41845721  163.54316007 1208.32382088
    0.            0.          316.27143624   22.7385804    72.86029052
    0.            0.            0.          976.58041126   41.0450044
  160.84535935    0.          228.11382376   55.14303709    0.        ]
begin_total_asset [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 1.22357956e+03 3.74226160e-01 0.00000000e+00 0.00000000e+00
 1.56860240e+01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 7.55400121e+02 2.75466470e+02 5.63599103e+01
 5.94254624e+02 5.02140959e+02 1.78252236e+02 0.00000000e+00]
self.daybefore_end_total_asset [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 1.21442646e+03 3.73790346e-01 0.00000000e+00 0.00000000e+00
 1.55135842e+01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 7.52913096e+02 2.65140613e+02 5.56093481e+01
 5.83152714e+02 4.98098691e+02 1.76537047e+02 0.00000000e+00]
self.args.diff: None
self.reward: 0.003816564695630223
sum end_total_asset(stocks): 4316.883381167544
self.state[0](cash): 95719.51919194305
today cost: 1.136702774007384
step_end: 2

step: 2
step == args.warmup+1
state.shape torch.Size([1, 269801])
normalized_tensor tensor([[ 0.8188,  0.1470,  0.1007, -0.3815, -1.2610, -0.3523, -0.3127,  0.5175,
         -0.3465,  2.0236,  1.2568,  0.4630, -0.0214,  0.3088,  0.8953,  0.5991,
         -2.7138, -0.6839, -0.0730, -0.9846]], device='cuda:0',
       grad_fn=<DivBackward0>)
action1: [ 0.8188062   0.14695737  0.1006687  -0.38145727 -1.2609617  -0.35229146
 -0.31265968  0.51750815 -0.34651187  2.0236418   1.2568095   0.46302158
 -0.02139259  0.3087696   0.89526254  0.5991207  -2.7138     -0.6839327
 -0.07296858 -0.9845903 ] <class 'numpy.ndarray'>
action2: [ 0.8584297   0.12475151  0.10909912 -0.34599155 -1.2678561  -0.3501976
 -0.3102873   0.5071988  -0.3650752   2.012267    1.2583122   0.41410512
 -0.03498977  0.3392797   0.8755295   0.60237336 -2.7136629  -0.7054828
 -0.07721237 -0.9809035 ]
action3: [ 0.8584297   0.12475151  0.10909912 -0.34599155 -1.         -0.3501976
 -0.3102873   0.5071988  -0.3650752   1.          1.          0.41410512
 -0.03498977  0.3392797   0.8755295   0.60237336 -1.         -0.7054828
 -0.07721237 -0.9809035 ]
day: 2 train
Reached the end.
self.asset_memory: [100000, 99998.23692615429, 100036.4025731106]
previous_total_asset:100000
end_total_asset:100036.4025731106
total_reward:36.40257311059395
total_cost:  2.8997766197421275
total trades:  22
size: 1
next_state_batch [[9.64364716e+04 5.24368360e+01 1.35268829e+02 ... 0.00000000e+00
  0.00000000e+00 0.00000000e+00]]
to_tensor(next_state_batch, volatile=True) torch.Size([1, 269801])
state.shape torch.Size([1, 269801])
normalized_tensor 100%|██████████| 3/3 [00:03<00:00,  1.61s/it]100%|██████████| 3/3 [00:03<00:00,  1.24s/it]
tensor([[ 0.8184,  0.1470,  0.1006, -0.3815, -1.2608, -0.3522, -0.3130,  0.5177,
         -0.3464,  2.0238,  1.2567,  0.4633, -0.0213,  0.3084,  0.8953,  0.5993,
         -2.7138, -0.6842, -0.0727, -0.9846]], device='cuda:0',
       grad_fn=<DivBackward0>)
target_q_batch: tensor([[42.9289]], device='cuda:0')
value_loss: tensor(4.6069, device='cuda:0', grad_fn=<MseLossBackward0>)
state.shape torch.Size([1, 269801])
normalized_tensor tensor([[ 0.8183,  0.1468,  0.1003, -0.3814, -1.2601, -0.3524, -0.3131,  0.5176,
         -0.3460,  2.0238,  1.2562,  0.4634, -0.0211,  0.3083,  0.8954,  0.5997,
         -2.7143, -0.6841, -0.0726, -0.9847]], device='cuda:0',
       grad_fn=<DivBackward0>)
policy_loss: tensor([[11.3349]], device='cuda:0', grad_fn=<NegBackward0>)
policy_loss_mean: tensor(11.3349, device='cuda:0', grad_fn=<MeanBackward0>)
step_end: 3
state.shape torch.Size([1, 269801])
normalized_tensor tensor([[ 0.7745,  0.1723,  0.0432, -0.3476, -1.1915, -0.3046, -0.3674,  0.5630,
         -0.3887,  2.0401,  1.2810,  0.4988, -0.0514,  0.2654,  0.8514,  0.6373,
         -2.7271, -0.6378, -0.0994, -1.0113]], device='cuda:0',
       grad_fn=<DivBackward0>)
action1: [ 0.77447206  0.17227237  0.04316407 -0.3476242  -1.1914786  -0.30458686
 -0.36744884  0.56300193 -0.38872206  2.0400705   1.2810392   0.498762
 -0.05135534  0.26535594  0.85142744  0.63726157 -2.7271054  -0.63776475
 -0.09940814 -1.0113332 ] <class 'numpy.ndarray'>
action2: [ 0.7909895   0.12036666  0.06887718 -0.35032797 -1.1742153  -0.3084724
 -0.35793915  0.5146073  -0.3804876   2.0469592   1.280663    0.47464237
 -0.07833278  0.28991356  0.8426577   0.6166576  -2.6986203  -0.6623907
 -0.09194899 -1.0215945 ]
action3: [ 0.7909895   0.12036666  0.06887718 -0.35032797 -1.         -0.3084724
 -0.35793915  0.5146073  -0.3804876   1.          1.          0.47464237
 -0.07833278  0.28991356  0.8426577   0.6166576  -1.         -0.6623907
 -0.09194899 -1.        ]
all finish
